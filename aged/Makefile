#
# Makefile to build aged related programs for any supported OSTYPE/MACHTYPE
#
# Phil Harvey - 12/2/98
#
# Notes:
#
# 1) Do a do a 'make clean' between builds of different aged versions
#    (normal, root and library versions), because these versions share
#    the same object files but are compiled with different options.
#
# 2) Set the AGED_OPTIONS environment variable to change the AGED
#    version compiler options.
#

ifndef OSTYPE
OSTYPE = $(shell uname -s | tr '[:upper:]' '[:lower:]')
else
OSTYPE := $(shell echo $(OSTYPE) | tr '[:upper:]' '[:lower:]')
endif
ifndef MACHTYPE
MACHTYPE = $(shell uname -m)
endif

PLATFORM      = $(OSTYPE)_$(MACHTYPE)$(AGED_MAKE_VER)

PROGS         = libaged.so

all: AGED_OPTIONS+=-O3 $(BUILD_FLAGS)
all: $(PROGS)

debug: AGED_OPTIONS+=-O0 $(BUILD_FLAGS)
debug: $(PROGS)

native: AGED_OPTIONS+=-O3 -march=native $(BUILD_FLAGS)
native: $(PROGS)

O2: AGED_OPTIONS+=-O2 $(BUILD_FLAGS)
O2: $(PROGS)

# Set all these dependencies to files that don't exist,
# thereby forcing the appropriate make to be performed each time.

#nt
libaged.so: aged_
	@echo Done.

# Call make again for the proper platform

aged_:
	@echo ==== Making libaged.so ====
	mkdir -p obj
	make "VERFLAGS=$(AGED_OPTIONS)" -f Makefile.$(PLATFORM) libaged.so $(MFLAGS)

# Utilities

clean:
	rm -f obj/*.o *.C *.so *.log core
	@echo Clean.
